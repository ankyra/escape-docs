name: heist/escape-docs
version: 0.3.@
depends:
- heist/escape-integration-tests-latest as escape

extends:
- extension-docker-kubespec-latest

inputs:
- default: escape-docs
  id: docker_image
- default:
  - deployment.yml
  id: kube_spec_files
  type: list[string]

includes:
- public/
- config.toml
- Dockerfile

metadata:
  core_version: $escape.metadata.core_version
  escape_version: $escape.metadata.escape_version
  inventory_version: $escape.metadata.inventory_version
  release_metadata_api_version: $escape.metadata.release_metadata_api_version

build_templates:
- file: config.toml.tpl
  mapping:
    escape_client_version: $escape.metadata.escape_version
    escape_inventory_version: $escape.metadata.inventory_version

deploy_templates:
- file: deployment.yml.tpl
  mapping:
    docker_image: $this.inputs.docker_repository.concat($this.inputs.docker_image,
      ":", $this.inputs.docker_image_version)

build: build.sh

